<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Шифрование и Декодирование</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2 {
            text-align: center;
        }
        .section {
            margin-bottom: 40px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        textarea, select, input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: #4285f4;
            color: white;
            border: none;
            font-size: 16px;
        }
        button:hover {
            background-color: #357ae8;
        }
        @media (max-width: 600px) {
            body {
                margin: 10px;
            }
            button {
                padding: 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <h1>Шифрование текста</h1>
    <div class="section">
        <label for="cipherMethod">Выберите метод шифрования:</label>
        <select id="cipherMethod">
            <option value="gronsfeld">Шифр Гронсфельда</option>
            <option value="trithemius">Шифр Трисемуса</option>
            <option value="playfair">Шифр Плейфера</option>
        </select>

        <label for="key">Введите ключ (для Плейфера - слово без повторяющихся букв):</label>
        <input type="text" id="key">

        <label for="plaintext">Введите текст для шифрования:</label>
        <textarea id="plaintext" rows="5"></textarea>

        <button onclick="encrypt()">Зашифровать</button>

        <h2>Зашифрованный текст:</h2>
        <textarea id="ciphertext" rows="5" readonly></textarea>
    </div>

    <h1>Декодирование текста</h1>
    <div class="section">
        <label for="decipherMethod">Выберите метод декодирования:</label>
        <select id="decipherMethod">
            <option value="gronsfeld">Шифр Гронсфельда</option>
            <option value="trithemius">Шифр Трисемуса</option>
            <option value="playfair">Шифр Плейфера</option>
        </select>

        <label for="dkey">Введите ключ (для Плейфера - слово без повторяющихся букв):</label>
        <input type="text" id="dkey">

        <label for="dciphertext">Введите текст для декодирования:</label>
        <textarea id="dciphertext" rows="5"></textarea>

        <button onclick="decrypt()">Декодировать</button>

        <h2>Декодированный текст:</h2>
        <textarea id="dplaintext" rows="5" readonly></textarea>
    </div>

    <script>
        function encrypt() {
            const method = document.getElementById('cipherMethod').value;
            const key = document.getElementById('key').value;
            const text = document.getElementById('plaintext').value;
            let result = '';

            if (method === 'gronsfeld') {
                result = gronsfeldCipher(text, key, true);
            } else if (method === 'trithemius') {
                result = trithemiusCipher(text, true);
            } else if (method === 'playfair') {
                result = playfairCipher(text, key, true);
            }

            document.getElementById('ciphertext').value = result;
        }

        function decrypt() {
            const method = document.getElementById('decipherMethod').value;
            const key = document.getElementById('dkey').value;
            const text = document.getElementById('dciphertext').value;
            let result = '';

            if (method === 'gronsfeld') {
                result = gronsfeldCipher(text, key, false);
            } else if (method === 'trithemius') {
                result = trithemiusCipher(text, false);
            } else if (method === 'playfair') {
                result = playfairCipher(text, key, false);
            }

            document.getElementById('dplaintext').value = result;
        }

        // Шифр Гронсфельда
        function gronsfeldCipher(text, key, encrypt = true) {
            const alphabet = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
            const fullKey = key.repeat(Math.ceil(text.length / key.length));
            let result = '';

            for (let i = 0; i < text.length; i++) {
                const letter = text[i].toUpperCase();
                const index = alphabet.indexOf(letter);

                if (index !== -1) {
                    const shift = parseInt(fullKey[i % fullKey.length]);
                    let newIndex = encrypt ? index + shift : index - shift;
                    newIndex = (newIndex + alphabet.length) % alphabet.length;
                    result += alphabet[newIndex];
                } else {
                    result += letter;
                }
            }
            return result;
        }

        // Шифр Трисемуса (Тритемиуса)
        function trithemiusCipher(text, encrypt = true) {
            const alphabet = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
            let result = '';
            let shift = 0;

            for (let i = 0; i < text.length; i++) {
                const letter = text[i].toUpperCase();
                const index = alphabet.indexOf(letter);

                if (index !== -1) {
                    let newIndex = encrypt ? index + shift : index - shift;
                    newIndex = (newIndex + alphabet.length) % alphabet.length;
                    result += alphabet[newIndex];
                    shift++;
                } else {
                    result += letter;
                }
            }
            return result;
        }

        // Шифр Плейфера
        function playfairCipher(text, key, encrypt = true) {
            const alphabet = 'АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЫЬЭЮЯ'; // Удалены Ё и Ъ
            key = key.toUpperCase().replace(/Ё|Ъ/g, '');
            let matrixKey = '';

            // Убираем повторяющиеся буквы из ключа
            for (let char of key) {
                if (matrixKey.indexOf(char) === -1 && alphabet.indexOf(char) !== -1) {
                    matrixKey += char;
                }
            }

            // Добавляем остальные буквы
            for (let char of alphabet) {
                if (matrixKey.indexOf(char) === -1) {
                    matrixKey += char;
                }
            }

            // Создаем матрицу 5x6
            const matrix = [];
            for (let i = 0; i < 6; i++) {
                matrix.push(matrixKey.slice(i * 5, i * 5 + 5).split(''));
            }

            // Подготовка текста
            text = text.toUpperCase().replace(/Ё|Ъ/g, '').replace(/\s/g, '');
            if (text.length % 2 !== 0) {
                text += 'Ь';
            }

            let result = '';
            for (let i = 0; i < text.length; i += 2) {
                let a = text[i];
                let b = text[i + 1];

                if (a === b) {
                    b = 'Ь';
                    i--;
                }

                let posA = findPosition(matrix, a);
                let posB = findPosition(matrix, b);

                if (posA && posB) {
                    if (posA.row === posB.row) {
                        // Одна строка
                        if (encrypt) {
                            result += matrix[posA.row][(posA.col + 1) % 5];
                            result += matrix[posB.row][(posB.col + 1) % 5];
                        } else {
                            result += matrix[posA.row][(posA.col + 4) % 5];
                            result += matrix[posB.row][(posB.col + 4) % 5];
                        }
                    } else if (posA.col === posB.col) {
                        // Один столбец
                        if (encrypt) {
                            result += matrix[(posA.row + 1) % 6][posA.col];
                            result += matrix[(posB.row + 1) % 6][posB.col];
                            } else {
                            result += matrix[(posA.row + 5) % 6][posA.col];
                            result += matrix[(posB.row + 5) % 6][posB.col];
                        }
                    } else {
                        // Прямоугольник
                        result += matrix[posA.row][posB.col];
                        result += matrix[posB.row][posA.col];
                    }
                } else {
                    result += a + b;
                }
            }
            return result;
        }

        function findPosition(matrix, char) {
            for (let row = 0; row < matrix.length; row++) {
                for (let col = 0; col < matrix[row].length; col++) {
                    if (matrix[row][col] === char) {
                        return { row, col };
                    }
                }
            }
            return null;
        }
    </script>
</body>
</html>
