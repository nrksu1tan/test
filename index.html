<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Шифрование и Декодирование</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2 {
            text-align: center;
        }
        .section {
            margin-bottom: 40px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        textarea, select, input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: #4285f4;
            color: white;
            border: none;
            font-size: 16px;
        }
        button:hover {
            background-color: #357ae8;
        }
        #developerOutput {
            display: none;
            margin-top: 20px;
            white-space: pre-wrap;
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #ccc;
        }
        @media (max-width: 600px) {
            body {
                margin: 10px;
            }
            button {
                padding: 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <h1>Шифрование текста</h1>
    <div class="section">
        <label for="cipherMethod">Выберите метод шифрования:</label>
        <select id="cipherMethod">
            <option value="gronsfeld">Шифр Гронсфельда</option>
            <option value="trithemius">Шифр Трисемуса</option>
            <option value="playfair">Шифр Плейфера</option>
        </select>

        <label for="key">Введите ключ:</label>
        <input type="text" id="key">

        <label for="plaintext">Введите текст для шифрования:</label>
        <textarea id="plaintext" rows="5"></textarea>

        <button onclick="encrypt()">Зашифровать</button>

        <h2>Зашифрованный текст:</h2>
        <textarea id="ciphertext" rows="5" readonly></textarea>
    </div>

    <h1>Декодирование текста</h1>
    <div class="section">
        <label for="decipherMethod">Выберите метод декодирования:</label>
        <select id="decipherMethod">
            <option value="gronsfeld">Шифр Гронсфельда</option>
            <option value="trithemius">Шифр Трисемуса</option>
            <option value="playfair">Шифр Плейфера</option>
        </select>

        <label for="dkey">Введите ключ:</label>
        <input type="text" id="dkey">

        <label for="dciphertext">Введите текст для декодирования:</label>
        <textarea id="dciphertext" rows="5"></textarea>

        <button onclick="decrypt()">Декодировать</button>

        <h2>Декодированный текст:</h2>
        <textarea id="dplaintext" rows="5" readonly></textarea>
    </div>

    <button onclick="showDeveloperInfo()">Разработчик</button>
    <div id="developerOutput"></div>

    <script>
        function encrypt() {
            const method = document.getElementById('cipherMethod').value;
            const key = document.getElementById('key').value;
            const text = document.getElementById('plaintext').value;
            let result = '';

            if (method === 'gronsfeld') {
                result = gronsfeldCipher(text, key, true);
            } else if (method === 'trithemius') {
                result = trithemiusCipher(text, key, true);
            } else if (method === 'playfair') {
                result = playfairCipher(text, key, true);
            }

            document.getElementById('ciphertext').value = result;
        }

        function decrypt() {
            const method = document.getElementById('decipherMethod').value;
            const key = document.getElementById('dkey').value;
            const text = document.getElementById('dciphertext').value;
            let result = '';

            if (method === 'gronsfeld') {
                result = gronsfeldCipher(text, key, false);
            } else if (method === 'trithemius') {
                result = trithemiusCipher(text, key, false);
            } else if (method === 'playfair') {
                result = playfairCipher(text, key, false);
            }

            document.getElementById('dplaintext').value = result;
        }

        function gronsfeldCipher(text, key, encrypt = true) {
            const alphabet = 'АБВГДЕЖЗИКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
            const textUpper = text.toUpperCase().replace(/Ё/g, 'Е').replace(/\s+/g, '');
            const keyNums = key.replace(/\D/g, '').split('').map(Number);
            if (keyNums.length === 0) {
                alert('Ключ должен содержать цифры для шифра Гронсфельда.');
                return '';
            }
            const fullKey = [];
            for (let i = 0; i < textUpper.length; i++) {
                fullKey.push(keyNums[i % keyNums.length]);
            }

            let result = '';
            for (let i = 0; i < textUpper.length; i++) {
                const letter = textUpper[i];
                const index = alphabet.indexOf(letter);

                if (index !== -1) {
                    let shift = fullKey[i];
                    if (!encrypt) shift = -shift;
                    let newIndex = (index + shift + alphabet.length) % alphabet.length;
                    result += alphabet[newIndex];
                } else {
                    result += letter;
                }
            }
            return result;
        }

        function trithemiusCipher(text, key, encrypt = true) {
            const alphabet = 'АБВГДЕЖЗИКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
            key = key.toUpperCase().replace(/[^А-Я]/g, '').replace(/Ё/g, 'Е');

            // Создаем таблицу шифрования
            let keyUnique = '';
            for (let char of key) {
                if (!keyUnique.includes(char)) {
                    keyUnique += char;
                }
            }
            for (let char of alphabet) {
                if (!keyUnique.includes(char)) {
                    keyUnique += char;
                }
            }

            let result = '';
            const textUpper = text.toUpperCase().replace(/Ё/g, 'Е').replace(/\s+/g, '');
            for (let char of textUpper) {
                const index = keyUnique.indexOf(char);

                if (index !== -1) {
                    let newIndex;
                    if (encrypt) {
                        newIndex = (index + 1) % keyUnique.length;
                    } else {
                        newIndex = (index - 1 + keyUnique.length) % keyUnique.length;
                    }
                    result += keyUnique[newIndex];
                } else {
                    result += char;
                }
            }

            return result;
        }

        function playfairCipher(text, key, encrypt = true) {
            const alphabet = 'ABCDEFGHIKLMNOPQRSTUVWXYZ'; // Для английского текста
            key = key.toUpperCase().replace(/[^A-Z]/g, '').replace(/J/g, 'I');

            // Убираем повторяющиеся буквы из ключа
            let matrixKey = '';
            for (let char of key) {
                if (!matrixKey.includes(char) && alphabet.includes(char)) {
                    matrixKey += char;
                }
            }
            // Добавляем остальные буквы
            for (let char of alphabet) {
                if (!matrixKey.includes(char)) {
                    matrixKey += char;
                }
            }

            // Создаем матрицу 5x5
            const matrix = [];
            for (let i = 0; i < 5; i++) {
                matrix.push(matrixKey.slice(i * 5, i * 5 + 5).split(''));
            }

            // Подготовка текста
            let preparedText = text.toUpperCase().replace(/[^A-Z]/g, '').replace(/J/g, 'I');
            let bigrams = [];
            for (let i = 0; i < preparedText.length; i += 2) {
                let a = preparedText[i];
                let b = preparedText[i + 1];
                if (b === undefined) {
                    b = 'X';
                }

                if (a === b) {
                    b = 'X';
                    i--;
                }
                bigrams.push([a, b]);
            }

            let result = '';
            for (let [a, b] of bigrams) {
                let posA = findPosition(matrix, a);
                let posB = findPosition(matrix, b);

                if (posA && posB) {
                    if (posA.row === posB.row) {
                        // Одна строка
                        if (encrypt) {
                            result += matrix[posA.row][(posA.col + 1) % 5];
                            result += matrix[posB.row][(posB.col + 1) % 5];
                        } else {
                            result += matrix[posA.row][(posA.col + 4) % 5];
                            result += matrix[posB.row][(posB.col + 4) % 5];
                        }
                    } else if (posA.col === posB.col) {
                        // Один столбец
                        if (encrypt) {
                            result += matrix[(posA.row + 1) % 5][posA.col];
                            result += matrix[(posB.row + 1) % 5][posB.col];
                        } else {
                            result += matrix[(posA.row + 4) % 5][posA.col];
                            result += matrix[(posB.row + 4) % 5][posB.col];
                        }
                    } else {
                        // Прямоугольник
                        result += matrix[posA.row][posB.col];
                        result += matrix[posB.row][posA.col];
                    }
                } else {
                    result += a + b;
                }
            }
            return result.match(/.{1,2}/g).join(' ');
        }

        function findPosition(matrix, char) {
            for (let row = 0; row < matrix.length; row++) {
                for (let col = 0; col < matrix[row].length; col++) {
                    if (matrix[row][col] === char) {
                        return { row, col };
                    }
                }
            }
            return null;
        }

        function showDeveloperInfo() {
            const outputDiv = document.getElementById('developerOutput');
            outputDiv.style.display = 'block';
            const method = document.getElementById('cipherMethod');
            const keyInput = document.getElementById('key');
            const textInput = document.getElementById('plaintext');

            const examples = {
                gronsfeld: {
                    key: '314',
                    text: 'СОВЕРШЕННОСЕКРЕТНО',
                    output: 'ФПЖИСЬИОССТКНСКХОТ'
                },
                trithemius: {
                    key: '',
                    text: 'СЛИВА',
                    output: 'КДЖНМ'
                },
                playfair: {
                    key: '',
                    text: 'HELLOWMOSCOW',
                    output: 'HE LX LO WM OS CO WX'
                }
            };

            const methodValue = method.value;

            if (methodValue === 'gronsfeld') {
                keyInput.value = '314';
                textInput.value = 'СОВЕРШЕННО СЕКРЕТНО';
                outputDiv.textContent = `Гронсфельд шифр
Ввод: С О В Е Р Ш Е Н Н О С Е К Р Е Т Н О
Ключ: 3 1 4 (повторяется)
Вывод: Ф П Ж И С Ь И О С С Т К Н С К Х О Т`;
            } else if (methodValue === 'trithemius') {
                keyInput.value = '';
                textInput.value = 'СЛИВА';
                outputDiv.textContent = `Трисемус шифр
Ввод: С Л И В А
Вывод: К Д Ж Н М`;
            } else if (methodValue === 'playfair') {
                keyInput.value = '';
                textInput.value = 'HELLOW MOSCOW';
                outputDiv.textContent = `Playfair шифр
Ввод: HELLOW MOSCOW
Вывод: HE LX LO WM OS CO WX`;
            } else {
                outputDiv.textContent = '';
            }
        }
    </script>
</body>
</html>
